FROM ansibleplaybookbundle/apb-base:release-1.3

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogJzEuMC4wJwpuYW1lOiBzdGFydGVyLXdvcmtzaG9wLWFwYgpkZXNjcmlwdGlvbjog\
QVBCIHRvIGRlcGxveSByZXF1aXJlZCBpbmZyYSBjb21wb25lbnRzIGZvciB0aGUgRGV2ZWxvcGVy\
IFN0YXJ0ZXIgV29ya3Nob3Agb24gYW4gT3BlblNoaWZ0IGNsdXN0ZXIKYmluZGFibGU6IEZhbHNl\
CmFzeW5jOiBvcHRpb25hbAp0YWdzOgotIHdvcmtzaG9wCm1ldGFkYXRhOgogIGRlcGVuZGVuY2ll\
czogWydkb2NrZXIuaW8vb3Nldmcvd29ya3Nob3BwZXI6bGF0ZXN0JywnZG9ja2VyLmlvL29wZW5z\
aGlmdGRlbW9zL2dvZ3M6MC4xMS4zNCcsJ3F1YXkuaW8vd2t1bGhhbmVrL2V0aGVycGFkOjEuNi41\
JywnZG9ja2VyLmlvL3NvbmF0eXBlL25leHVzMzozLjExLjAnLCAnZG9ja2VyLmlvL3JhZmZhZWxl\
c3BhenpvbGkvb2NwLW9wcy12aWV3OmxhdGVzdCcsICdxdWF5LmlvL29wZW5zaGlmdGxhYnMvd29y\
a3Nob3Atc3Bhd25lcjozLjAuNScsICdxdWF5LmlvL29wZW5zaGlmdGxhYnMvd29ya3Nob3AtdGVy\
bWluYWw6Mi42LjEnXQogIGRpc3BsYXlOYW1lOiAiT3BlblNoaWZ0IERldmVsb3BlciBTdGFydGVy\
IFdvcmtzaG9wIEluc3RhbGxlciIKICBsb25nRGVzY3JpcHRpb246IHwtCiAgICBJbnN0YWxscyB0\
aGUgbGFiIGluc3RydWN0aW9ucyBhbmQgcmVxdWlyZWQgY29tcG9uZW50cwogICAgLSBHb2dzIHNl\
cnZlcgogICAgLSBOZXh1cwogICAgLSBFdGhlcnBhZAogICAgLSBMYWIgR3VpZGVzCiAgICAtIE9D\
UC1PcHNWaWV3IChpbWFnZSBieSBSYWZmYWVsZSBTcGF6em9saSkKICAgIC0gT3BlblNoaWZ0IFdv\
cmtzaG9wIFRlcm1pbmFsCiAgICBmb3IgcnVubmluZyB0aGUgR2V0dGluZyBTdGFydGVkIGRldmVs\
b3Bpbmcgb24gT3BlblNoaWZ0IFdvcmtzaG9wIGh0dHBzOi8vZ2l0aHViLmNvbS9vcGVuc2hpZnQt\
bGFicy9zdGFydGVyLWd1aWRlcwogIGNvbnNvbGUub3BlbnNoaWZ0LmlvL2ljb25DbGFzczogInBm\
aWNvbiBwZmljb24tcHJvY2Vzcy1hdXRvbWF0aW9uIgogIHByb3ZpZGVyRGlzcGxheU5hbWU6ICJS\
ZWQgSGF0LCBJbmMuIgpwbGFuczoKICAtIG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBE\
ZXBsb3lzIE9wZW5TaGlmdCBTdGFydGVyIFdvcmtzaG9wIEluZnJhc3RydWN0dXJlCiAgICBmcmVl\
OiBUcnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IERlZmF1bHQKICAgIHBhcmFt\
ZXRlcnM6CiAgICAtIG5hbWU6IG9wZW5zaGlmdF91c2VyCiAgICAgIHRpdGxlOiBVc2VybmFtZQog\
ICAgICBkZXNjcmlwdGlvbjogVXNlciBpcyByZXF1aXJlZCBmb3IgY3JlYXRpbmcgcHJvamVjdCBh\
ZG1pbiByZXNvdXJjZXMKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgIGRpc3BsYXlfdHlwZTogdGV4dAogICAgICBkaXNwbGF5X2dyb3VwOiBPcGVuU2hpZnQgVXNl\
cgogICAgLSBuYW1lOiBvcGVuc2hpZnRfcGFzc3dvcmQKICAgICAgdGl0bGU6IFBhc3N3b3JkCiAg\
ICAgIGRlc2NyaXB0aW9uOiBQYXNzd29yZCBpcyByZXF1aXJlZCBmb3IgY3JlYXRpbmcgcHJvamVj\
dCBhZG1pbiByZXNvdXJjZXMKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHJlcXVpcmVkOiB0cnVl\
CiAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgZGlzcGxheV9ncm91cDogT3BlblNo\
aWZ0IFVzZXIKICAgIC0gbmFtZTogd29ya3Nob3BfdHlwZQogICAgICB0aXRsZTogV29ya3Nob3Ag\
dHlwZQogICAgICBkZXNjcmlwdGlvbjogVHlwZSBvZiB3b3Jrc2hvcCB0byBkZWxpdmVyIChqYXZh\
LCBweXRob24sIG5vZGUuanMsIHBocCkKICAgICAgdHlwZTogZW51bQogICAgICBlbnVtOiBbJ2ph\
dmEnLCAncHl0aG9uJywgJ25vZGUuanMnLCAncGhwJ10KICAgICAgcmVxdWlyZWQ6IHRydWUKICAg\
ICAgZGlzcGxheV90eXBlOiBzZWxlY3QKICAgICAgZGVmYXVsdDogamF2YQogICAgICBkaXNwbGF5\
X2dyb3VwOiBXb3Jrc2hvcAogICAgLSBuYW1lOiB1c2VyX2NvdW50CiAgICAgIHRpdGxlOiBOdW1i\
ZXIgb2YgcGFydGljaXBhbnRzCiAgICAgIGRlc2NyaXB0aW9uOiBOdW1iZXIgb2YgcGFydGljaXBh\
bnRzIGZvciB0aGUgd29ya3Nob3AuIFRoZXJlIHdpbGwgYmUgcHJvdmlzaW9uZWQgaW5mcmFzdHJ1\
Y3R1cmUgZm9yIGVhY2ggcGFydGljaXBhbnQKICAgICAgdHlwZTogbnVtYmVyCiAgICAgIHJlcXVp\
cmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wCiMgICAgLSBuYW1lOiBvcGVu\
c2hpZnRfdXNlcl9wYXNzd29yZAojICAgICAgdGl0bGU6IE9wZW5TaGlmdCBVc2VyIFBhc3N3b3Jk\
CiMgICAgICBkZXNjcmlwdGlvbjogVGhlIE9wZW5TaGlmdCBwYXNzd29yZCBmb3IgcGFydGljaXBh\
bnRzIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgbGFiIGd1aWRlIHRvIHBhcnRpY2lwYW50cwojICAg\
ICAgdHlwZTogc3RyaW5nCiMgICAgICByZXF1aXJlZDogdHJ1ZQojICAgICAgZGlzcGxheV90eXBl\
OiB0ZXh0CiMgICAgICBkaXNwbGF5X2dyb3VwOiBXb3Jrc2hvcAogICAgLSBuYW1lOiBpbmZyYXN2\
Y3NfYWRtX3VzZXIKICAgICAgdGl0bGU6IEluZnJhc3RydWN0dXJlIFNlcnZpY2VzIEFkbWluIFVz\
ZXIKICAgICAgZGVzY3JpcHRpb246IEFkbWluIHVzZXIgZm9yIGluZnJhc3RydWN0dXJlIHNlcnZp\
Y2VzIChHb2dzLCBOZXh1cywgLi4uKQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDog\
ImFkbWludXNlciIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiB0ZXh0\
CiAgICAgIGRpc3BsYXlfZ3JvdXA6IEluZnJhc3RydWN0dXJlIFNlcnZpY2VzCiAgICAtIG5hbWU6\
IGluZnJhc3Zjc19hZG1fcGFzc3dvcmQKICAgICAgdGl0bGU6IEluZnJhc3RydWN0dXJlIFNlcnZp\
Y2VzIEFkbWluIFBhc3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBBZG1pbiBwYXNzd29yZCBmb3Ig\
aW5mcmFzdHJ1Y3R1cmUgc2VydmljZXMgKEdvZ3MsIE5leHVzLCAuLi4pCiAgICAgIHR5cGU6IHN0\
cmluZwogICAgICBkZWZhdWx0OiAiYWRtaW4xMjMiCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAg\
IGRpc3BsYXlfdHlwZTogdGV4dAogICAgICBkaXNwbGF5X2dyb3VwOiBJbmZyYXN0cnVjdHVyZSBT\
ZXJ2aWNlcwo="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb

ENV BUNDLE_DEBUG=true
